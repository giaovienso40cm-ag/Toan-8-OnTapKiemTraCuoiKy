<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√ÄI T·∫¨P TR·∫ÆC NGHI·ªÜM √îN T·∫¨P HKI TO√ÅN 8 </title>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$']], processEscapes: true },
            options: { ignoreHtmlClass: 'tex2jax_ignore', processHtmlClass: 'tex2jax_process' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        /* ƒê·ªãnh nghƒ©a m√†u b·∫£ng t·ª´ v√† font ch·ªØ 130% */
        :root {
            --board: #073b31;
            --white: #ffffff;
            --gold: #ffeb3b;
            --wood: #3e2723;
        }

        body {
            background-color: var(--board);
            color: var(--white);
            font-family: 'Times New Roman', serif;
            font-size: 150%; 
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        /* Ti√™u ƒë·ªÅ c·ªë ƒë·ªãnh tr√™n c√πng */
        .header-fixed {
            position: sticky; top: 0; width: 100%; background: var(--wood);
            text-align: center; padding: 10px 0; border-bottom: 4px solid #1b1b1b;
            z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.4); text-transform: uppercase;
        }

        .info-bar {
            background: rgba(0,0,0,0.3); width: 100%; text-align: center;
            padding: 5px 0; font-size: 0.7em; color: var(--gold); border-bottom: 2px solid var(--white);
        }

        #quiz-app { width: 95%; max-width: 850px; padding: 20px; box-sizing: border-box; }

        .screen { display: none; }
        .active { display: block; }

        /* Trang ƒë·∫ßu trang tr√≠ khung vi·ªÅn chuy√™n nghi·ªáp */
        .welcome-box {
            border: 8px double var(--white); padding: 40px; border-radius: 30px;
            background: rgba(255, 255, 255, 0.05); text-align: center; margin-top: 30px;
        }

        input[type="text"] {
            width: 100%; padding: 15px; font-size: 1.2rem; border-radius: 10px;
            border: none; margin: 15px 0; outline: none; box-sizing: border-box;
        }

        /* Hi·ªáu ·ª©ng ƒë√°p √°n s√°ng khung */
        .option {
            border: 2px solid var(--white); padding: 15px 25px; margin: 15px 0;
            border-radius: 15px; cursor: pointer; transition: 0.3s;
            background: rgba(255, 255, 255, 0.1); display: flex; align-items: center;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.2); border-color: var(--gold);
            box-shadow: 0 0 20px var(--gold); transform: scale(1.02);
        }

        .correct { background-color: #2e7d32 !important; border-color: #a5d6a7 !important; }
        .wrong { background-color: #c62828 !important; border-color: #ef9a9a !important; }

        /* B·∫£ng gi·ªØ nguy√™n d√≤ng c·ªôt */
        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.9em; }
        th, td { border: 2px solid var(--white); padding: 12px; text-align: center; }

        .explanation {
            background: #ffffff; color: #000; padding: 20px; border-radius: 15px;
            margin-top: 20px; display: none; border-left: 10px solid var(--gold);
        }

       /* T√¨m ƒë·∫øn .btn-action ho·∫∑c .btn-main v√† s·ª≠a l·∫°i c√°c d√≤ng n√†y */
.btn-main {
    width: fit-content;      /* Gi√∫p n√∫t v·ª´a kh√≠t v·ªõi n·ªôi dung ch·ªØ */
    min-width: 200px;        /* (T√πy ch·ªçn) ƒê·ªô r·ªông t·ªëi thi·ªÉu ƒë·ªÉ n√∫t kh√¥ng qu√° nh·ªè tr√™n ƒëi·ªán tho·∫°i */
    padding: 15px 30px;      /* Kho·∫£ng c√°ch ƒë·ªám xung quanh ch·ªØ cho ƒë·∫πp */
    margin: 20px auto;       /* CƒÉn gi·ªØa n√∫t v√† t·∫°o kho·∫£ng c√°ch tr√™n d∆∞·ªõi */
    display: block;          /* ƒê·ªÉ margin: auto c√≥ t√°c d·ª•ng cƒÉn gi·ªØa */
    background: var(--gold);
    color: #000;
    border: none;
    border-radius: 15px;
    font-size: 1.3rem;
    font-weight: bold;
    cursor: pointer;
}
        svg { display: block; margin: 20px auto; max-width: 100%; }

        #music-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 2000;
            background: var(--gold); border: none; border-radius: 50%; width: 60px; height: 60px;
            cursor: pointer; box-shadow: 0 0 15px rgba(0,0,0,0.5); font-size: 1.5rem;
            display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div class="header-fixed">
    √îN T·∫¨P TR·∫ÆC NGHI·ªÜM TO√ÅN 8 - H·ªåC K√å I
    <div id="student-header" class="info-bar">
        [H·ªçc sinh]. [L·ªõp]. [ƒêi·ªÉm: 0]. [L·∫ßn l√†m l·∫°i: 0]
    </div>
</div>

<button id="music-btn" onclick="toggleMusic()">üéµ</button>

<div id="quiz-app">
    <div id="start-screen" class="screen active">
        <div class="welcome-box">
            <h2 style="color: var(--gold);">C·ªê G·∫ÆNG L√ÄM B√ÄI EM NH√â !.</h2>
            <div style="text-align: left;">
                <label>H·ªç v√† t√™n h·ªçc sinh:</label>
                <input type="text" id="name-input" placeholder="Nh·∫≠p h·ªç t√™n...">
                <label>L·ªõp:</label>
                <input type="text" id="class-input" placeholder="V√≠ d·ª•: 8A1">
            </div>
            <button class="btn-main" onclick="startQuiz()">B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI</button>
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <div id="q-text" style="font-weight: bold; margin-bottom: 20px;"></div>
        <div id="q-media"></div>
        <div id="options-area"></div>
        <div id="explain-box" class="explanation"></div>
        <button id="btn-next" class="btn-main" style="display:none; margin-top:20px;" onclick="goNext()">C√ÇU TI·∫æP THEO</button>
    </div>

    <div id="result-screen" class="screen">
        <div class="welcome-box">
            <h2 style="color: var(--gold);">K·∫æT QU·∫¢ B√ÄI L√ÄM</h2>
            <p id="final-score" style="font-size: 2rem;"></p>
            <div id="thanks-container" style="margin: 20px 0; font-weight: bold; color: var(--gold);"></div>
            <button id="submit-btn" class="btn-main" onclick="submitScore()">N·ªòP B√ÄI L√äN H·ªÜ TH·ªêNG</button>
            <button class="btn-main" style="background:#b0bec5; margin-top:15px;" onclick="restartAll()">L√ÄM L·∫†I TO√ÄN B√ÄI</button>
            <p id="status-text" style="margin-top:20px; font-size: 0.8em;"></p>
        </div>
    </div>
</div>

<audio id="bg-music" loop><source src="nhac-nen.mp3" type="audio/mpeg"></audio>
<audio id="snd-correct" preload="auto"><source src="dung.mp3" type="audio/mpeg"></audio>
<audio id="snd-wrong" preload="auto"><source src="sai.mp3" type="audio/mpeg"></audio>

<script>
    // GI√ÅO VI√äN D√ÅN LINK APPS SCRIPT V√ÄO ƒê√ÇY
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwaL0s6R4_74QQS5ImzYE2_nRr5DRJ5rUPnDY5h1-8-UrgZVpk25mwkcjCNI8-r0b3n/exec";

    // C∆° s·ªü d·ªØ li·ªáu 30 c√¢u h·ªèi (Kh√¥i ph·ª•c t·ª´ file Word)
    const DB = [
        { q: "C√¢u 1: Trong c√°c bi·ªÉu th·ª©c sau, bi·ªÉu th·ª©c n√†o l√† ƒë∆°n th·ª©c?", a: ["$x + y$", "$2x^2y$", "$x^2 - 1$", "$\\frac{x}{y}$"], c: 1, e: "ƒê∆°n th·ª©c l√† bi·ªÉu th·ª©c ƒë·∫°i s·ªë ch·ªâ g·ªìm m·ªôt s·ªë, ho·∫∑c m·ªôt bi·∫øn, ho·∫∑c m·ªôt t√≠ch gi·ªØa c√°c s·ªë v√† c√°c bi·∫øn." },
        { q: "C√¢u 2: Trong c√°c bi·ªÉu th·ª©c sau, bi·ªÉu th·ª©c n√†o kh√¥ng ph·∫£i l√† ƒë∆°n th·ª©c?", a: ["$x$", "$2y$", "$x - 2y$", "$-5$"], c: 2, e: "$x-2y$ l√† ƒëa th·ª©c v√¨ ch·ª©a ph√©p tr·ª´." },
        { q: "C√¢u 3: Trong c√°c bi·ªÉu th·ª©c sau, bi·ªÉu th·ª©c n√†o kh√¥ng ph·∫£i l√† ƒëa th·ª©c?", a: ["$x^2 + 1$", "$2x$", "$\\frac{3}{x}$", "$0$"], c: 2, e: "Bi·ªÉu th·ª©c c√≥ bi·∫øn ·ªü m·∫´u kh√¥ng ph·∫£i l√† ƒëa th·ª©c." },
        { q: "C√¢u 4: Trong c√°c bi·ªÉu th·ª©c sau, bi·ªÉu th·ª©c n√†o l√† ƒë∆°n th·ª©c thu g·ªçn?", a: ["$2x.x.y$", "$3xy^2$", "$x^2y.x$", "$-2x^2y.3$"], c: 1, e: "ƒê∆°n th·ª©c thu g·ªçn l√† ƒë∆°n th·ª©c m√† m·ªói bi·∫øn ch·ªâ xu·∫•t hi·ªán m·ªôt l·∫ßn d∆∞·ªõi d·∫°ng l≈©y th·ª´a." },
        { q: "C√¢u 5: H·ªá s·ªë c·ªßa ƒë∆°n th·ª©c $-3x^2y$ l√†:", a: ["$3$", "$x^2y$", "$-3$", "$-3x^2$"], c: 2, e: "H·ªá s·ªë l√† ph·∫ßn s·ªë ƒë·ª©ng tr∆∞·ªõc c√°c bi·∫øn." },
        { q: "C√¢u 6: ƒê∆°n th·ª©c $2x^2y^3$ c√≥ b·∫≠c l√†:", a: ["$2$", "$3$", "$5$", "$6$"], c: 2, e: "B·∫≠c l√† t·ªïng s·ªë m≈© c·ªßa c√°c bi·∫øn: $2+3=5$." },
        { q: "C√¢u 7: ƒêa th·ª©c $x^4 - 3x^2 + 1$ c√≥ b·∫≠c l√†:", a: ["$4$", "$2$", "$1$", "$0$"], c: 0, e: "B·∫≠c c·ªßa ƒëa th·ª©c l√† b·∫≠c cao nh·∫•t trong c√°c h·∫°ng t·ª≠." },
        { q: "C√¢u 8: ƒê∆°n th·ª©c ƒë·ªìng d·∫°ng v·ªõi ƒë∆°n th·ª©c $3x^2y$ l√†:", a: ["$3xy^2$", "$-x^2y$", "$3x^2z$", "$2xy$"], c: 1, e: "ƒê∆°n th·ª©c ƒë·ªìng d·∫°ng ph·∫£i c√≥ c√πng ph·∫ßn bi·∫øn." },
        { q: "C√¢u 9: K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $2x . 3xy$ l√†:", a: ["$5x^2y$", "$6x^2y$", "$6xy^2$", "$5xy$"], c: 1, e: "$(2.3).(x.x).y = 6x^2y$." },
        { q: "C√¢u 10: K·∫øt qu·∫£ thu g·ªçn c·ªßa ƒëa th·ª©c $2x + 3y - x$ l√†:", a: ["$x + 3y$", "$3x + 3y$", "$2 + 3y$", "$x - 3y$"], c: 0, e: "Thu g·ªçn c√°c h·∫°ng t·ª≠ ƒë·ªìng d·∫°ng: $2x-x=x$." },
        { q: "C√¢u 11: K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $(x+1)(x-1)$ l√†:", a: ["$x^2+1$", "$x^2-1$", "$x^2-2x+1$", "$x^2+2x+1$"], c: 1, e: "H·∫±ng ƒë·∫≥ng th·ª©c hi·ªáu hai b√¨nh ph∆∞∆°ng: $(A-B)(A+B) = A^2-B^2$." },
        { q: "C√¢u 12: K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $x(x+2)$ l√†:", a: ["$x^2+2$", "$2x+2$", "$x^2+2x$", "$x^2-2x$"], c: 2, e: "Nh√¢n ƒë∆°n th·ª©c v·ªõi ƒëa th·ª©c: $x.x + x.2 = x^2+2x$." },
        { q: "C√¢u 13: K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $(x+y)^2$ l√†:", a: ["$x^2+y^2$", "$x^2-y^2$", "$x^2+2xy+y^2$", "$x^2-2xy+y^2$"], c: 2, e: "H·∫±ng ƒë·∫≥ng th·ª©c b√¨nh ph∆∞∆°ng c·ªßa m·ªôt t·ªïng." },
        { q: "C√¢u 14: K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $(2x)^2$ l√†:", a: ["$2x^2$", "$4x^2$", "$4x$", "$2x$"], c: 1, e: "$(2x)^2 = 2^2.x^2 = 4x^2$." },
        { q: "C√¢u 15: Khai tri·ªÉn $x^2 - 4$ theo h·∫±ng ƒë·∫≥ng th·ª©c ta ƒë∆∞·ª£c:", a: ["$(x-2)(x+2)$", "$(x-4)(x+4)$", "$(x-2)^2$", "$(x+2)^2$"], c: 0, e: "$x^2-2^2 = (x-2)(x+2)$." },
        { q: "C√¢u 16: Khai tri·ªÉn $(x-1)^2$ theo h·∫±ng ƒë·∫≥ng th·ª©c ta ƒë∆∞·ª£c:", a: ["$x^2-1$", "$x^2+1$", "$x^2-2x+1$", "$x^2+2x+1$"], c: 2, e: "H·∫±ng ƒë·∫≥ng th·ª©c b√¨nh ph∆∞∆°ng c·ªßa m·ªôt hi·ªáu." },
        { q: "C√¢u 17: Cho t·ª© gi√°c ABCD t·ªïng s·ªë ƒëo c√°c g√≥c c·ªßa t·ª© gi√°c l√†:", a: ["$90^\\circ$", "$180^\\circ$", "$270^\\circ$", "$360^\\circ$"], c: 3, e: "T·ªïng c√°c g√≥c trong m·ªôt t·ª© gi√°c b·∫±ng $360^\\circ$." },
        { q: "C√¢u 18: Cho h√¨nh v·∫Ω, trong ƒë√≥ DE // BC, theo ƒë·ªãnh l√≠ Thales kh·∫≥ng ƒë·ªãnh n√†o sai:", img: "thales", a: ["$\\frac{AD}{AB} = \\frac{AE}{AC}$", "$\\frac{AD}{DB} = \\frac{AE}{EC}$", "$\\frac{AD}{AB} = \\frac{DE}{BC}$", "$\\frac{DB}{AB} = \\frac{EC}{AC}$"], c: 2, e: "Theo ƒë·ªãnh l√≠ Thales, kh·∫≥ng ƒë·ªãnh C l√† sai (ƒë√≥ l√† h·ªá qu·∫£)." },
        { q: "C√¢u 19: Bi·∫øt $MN // BC$ v√† $MN=3, AM=2, MB=6$. BC b·∫±ng:", img: "midsegment", a: ["$8cm$", "$9cm$", "$12cm$", "$15cm$"], c: 2, e: "Ta c√≥ $AB=8$. $\\frac{AM}{AB} = \\frac{MN}{BC} \\Rightarrow \\frac{2}{8} = \\frac{3}{BC} \\Rightarrow BC = 12$." },
        { q: "C√¢u 20: T√≠nh ch·∫•t c·ªßa h√¨nh thang c√¢n:", a: ["Hai c·∫°nh b√™n b·∫±ng nhau.", "Hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau.", "C·∫£ A v√† B ƒë·ªÅu ƒë√∫ng.", "C·∫£ A v√† B ƒë·ªÅu sai."], c: 2, e: "H√¨nh thang c√¢n c√≥ hai c·∫°nh b√™n b·∫±ng nhau v√† hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau." },
        { q: "C√¢u 21: Trong c√°c kh·∫≥ng ƒë·ªãnh sau, kh·∫≥ng ƒë·ªãnh n√†o sai?", a: ["T·ª© gi√°c c√≥ 3 g√≥c vu√¥ng l√† HCN.", "HBH c√≥ m·ªôt g√≥c vu√¥ng l√† HCN.", "HBH c√≥ 2 ƒë∆∞·ªùng ch√©o c·∫Øt nhau t·∫°i trung ƒëi·ªÉm l√† HCN.", "T·ª© gi√°c c√≥ c√°c c·∫°nh ƒë·ªëi b·∫±ng nhau l√† HBH."], c: 2, e: "M·ªçi HBH ƒë·ªÅu c√≥ 2 ƒë∆∞·ªùng ch√©o c·∫Øt nhau t·∫°i trung ƒëi·ªÉm, n√™n kh·∫≥ng ƒë·ªãnh n√†y sai." },
        { q: "C√¢u 22: Trong c√°c kh·∫≥ng ƒë·ªãnh sau, kh·∫≥ng ƒë·ªãnh n√†o sai?", a: ["HCN c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau l√† h√¨nh vu√¥ng.", "H√¨nh thoi c√≥ hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c l√† h√¨nh vu√¥ng.", "H√¨nh thoi c√≥ m·ªôt g√≥c vu√¥ng l√† h√¨nh vu√¥ng.", "HCN c√≥ m·ªôt g√≥c vu√¥ng l√† h√¨nh vu√¥ng."], c: 0, e: "HCN v·ªën dƒ© ƒë√£ c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau, kh√¥ng th·ªÉ k·∫øt lu·∫≠n l√† h√¨nh vu√¥ng." },
        { q: "C√¢u 23: Ch·ªçn ƒë√°p √°n sai. T√≠nh ch·∫•t c·ªßa h√¨nh b√¨nh h√†nh:", a: ["Hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c.", "C√°c c·∫°nh ƒë·ªëi b·∫±ng nhau.", "C√°c g√≥c ƒë·ªëi b·∫±ng nhau.", "Hai ƒë∆∞·ªùng ch√©o c·∫Øt nhau t·∫°i trung ƒëi·ªÉm."], c: 0, e: "Hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c l√† t√≠nh ch·∫•t c·ªßa h√¨nh thoi." },
        { q: "C√¢u 24: T√≠nh ch·∫•t c·ªßa h√¨nh thoi:", a: ["Hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c.", "Hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau.", "Hai c·∫°nh k·ªÅ vu√¥ng g√≥c.", "Hai g√≥c k·ªÅ b·∫±ng nhau."], c: 0, e: "H√¨nh thoi c√≥ hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c v·ªõi nhau." },
        { q: "C√¢u 25: D·ªØ li·ªáu n√†o sau ƒë√¢y l√† d·ªØ li·ªáu ƒë·ªãnh t√≠nh?", a: ["S·ªë ti·ªÅn.", "T√™n c√°c h√£ng ƒëi·ªán tho·∫°i.", "Th·ªùi gian ng·ªß.", "C√¢n n·∫∑ng tr·∫ª s∆° sinh."], c: 1, e: "T√™n h√£ng ƒëi·ªán tho·∫°i l√† d·ªØ li·ªáu ch·ªØ, kh√¥ng ph·∫£i s·ªë." },
        { q: "C√¢u 26: D·ªØ li·ªáu n√†o sau ƒë√¢y l√† d·ªØ li·ªáu ƒë·ªãnh l∆∞·ª£ng?", a: ["T√™n m√¥n h·ªçc.", "T√™n lo√†i ƒë·ªông v·∫≠t.", "Chi·ªÅu cao trung b√¨nh.", "Qu·ªëc t·ªãch h·ªçc sinh."], c: 2, e: "Chi·ªÅu cao l√† s·ªë ƒëo (m√©t) n√™n l√† ƒë·ªãnh l∆∞·ª£ng." },
        { q: "C√¢u 27: Ph∆∞∆°ng ph√°p n√†o ph√π h·ª£p l·∫•y √Ω ki·∫øn cha m·∫π v·ªÅ ho·∫°t ƒë·ªông tr∆∞·ªùng?", a: ["Quan s√°t tr·ª±c ti·∫øp.", "Ph·ªèng v·∫•n, l·∫≠p phi·∫øu thƒÉm d√≤.", "Thu th·∫≠p Internet.", "L√†m th√≠ nghi·ªám."], c: 1, e: "L·∫≠p phi·∫øu thƒÉm d√≤ l√† c√°ch hi·ªáu qu·∫£ nh·∫•t ƒë·ªÉ l·∫•y √Ω ki·∫øn s·ªë ƒë√¥ng." },
        { q: "C√¢u 28: L·ª±a ch·ªçn bi·ªÉu ƒë·ªì th√≠ch h·ª£p cho b·∫£ng th·ªëng k√™ sau:", hasTable: true, a: ["Bi·ªÉu ƒë·ªì h√¨nh qu·∫°t tr√≤n.", "Bi·ªÉu ƒë·ªì c·ªôt.", "Bi·ªÉu ƒë·ªì ƒëo·∫°n th·∫≥ng.", "Bi·ªÉu ƒë·ªì c·ªôt k√©p."], c: 0, e: "D·ªØ li·ªáu ph·∫ßn trƒÉm t·ªïng th·ªÉ th∆∞·ªùng d√πng bi·ªÉu ƒë·ªì h√¨nh qu·∫°t tr√≤n." },
        { 
           q: "C√¢u 29: Cho h√¨nh v·∫Ω b√™n, h√£y x√°c ƒë·ªãnh ƒê√∫ng hay Sai:", 
            img: "midsegments", 
            isTF: true, 
            sub: ["MN l√† ƒë∆∞·ªùng trung b√¨nh c·ªßa tam gi√°c ABC.", "BC = 8 cm", "MN // BC", "BC = 8 dm"], 
            ans: [true, true, true, false], 
            e: "ƒê∆∞·ªùng trung b√¨nh tam gi√°c song song v·ªõi ƒë√°y v√† b·∫±ng n·ª≠a ƒë√°y." 
        },
        { 
            q: "C√¢u 30: Cho tam gi√°c ABC, AD l√† m·ªôt ƒëo·∫°n th·∫≥ng. H√£y x√°c ƒë·ªãnh ƒê√∫ng hay Sai:", 
            img: "bisector", 
            isTF: true, 
            sub: ["AD l√† ƒë∆∞·ªùng trung tuy·∫øn c·ªßa tam gi√°c ABC", "AD l√† ƒë∆∞·ªùng trung b√¨nh c·ªßa tam gi√°c ABC", "x = 11,2 cm", "x = 10,2 cm"], 
            ans: [false, true, true, false], 
            e: "D·ª±a v√†o d·ªØ ki·ªán h√¨nh v·∫Ω ƒë·ªÉ t√≠nh ƒë·ªô d√†i x." 
        }
];

    let current = 0, score = 0, retry = 0;
    let sName = "", sClass = "";

    // H√†m ph√°t √¢m thanh chu·∫©n
    function playSnd(id) {
        const s = document.getElementById(id);
        if (s) { s.currentTime = 0; s.play().catch(e => console.log(e)); }
    }

    function toggleMusic() {
        const m = document.getElementById('bg-music');
        const b = document.getElementById('music-btn');
        if (m.paused) { m.play(); b.innerText = "üîá"; }
        else { m.pause(); b.innerText = "üéµ"; }
    }

    function startQuiz() {
        sName = document.getElementById('name-input').value.trim();
        sClass = document.getElementById('class-input').value.trim();
        if(!sName || !sClass) return alert("Em nh·∫≠p t√™n v√† l·ªõp nh√©!");
        document.getElementById('bg-music').play();
        updateHeader();
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');
        renderQuestion();
    }

    function updateHeader() {
        document.getElementById('student-header').innerText = `${sName}. L·ªõp: ${sClass}. ƒêi·ªÉm: ${Math.round(score * 10) / 10}. L·∫ßn l√†m l·∫°i: ${retry}`;
    }

       // V·∫Ω h√¨nh SVG chu·∫©n n√©t tr·∫Øng
        function drawSVG(type) {
        if(type === "bisector") {
            return `<svg width="350" height="250" viewBox="0 0 350 250">
                <path d="M150 40 L40 200 L310 200 Z" fill="none" stroke="white" stroke-width="3"/>
                <line x1="150" y1="40" x2="164" y2="200" stroke="white" stroke-width="3"/>
                <path d="M 132 65 A 30 30 0 0 0 172 63" fill="none" stroke="white" stroke-width="2"/>
                <text x="145" y="30" fill="white">A</text><text x="25" y="215" fill="white">B</text>
                <text x="315" y="215" fill="white">C</text><text x="160" y="220" fill="white">D</text>
                <text x="50" y="120" fill="white">5cm</text><text x="250" y="120" fill="white">8cm</text>
                <text x="80" y="220" fill="white">7cm</text><text x="220" y="220" fill="yellow">x</text>
            </svg>`;
        }
        if(type === "thales") {
            return `<svg width="300" height="200" viewBox="0 0 300 200">
                <path d="M150 20 L50 180 L250 180 Z" fill="none" stroke="white" stroke-width="3"/>
                <line x1="100" y1="100" x2="200" y2="100" stroke="white" stroke-width="3"/>
                <text x="145" y="15" fill="white">A</text><text x="35" y="195" fill="white">B</text>
                <text x="255" y="195" fill="white">C</text><text x="75" y="105" fill="white">D</text>
                <text x="210" y="105" fill="white">E</text>
            </svg>`;
        }
 if(type === "midsegment") {
            return `<svg width="300" height="200" viewBox="0 0 300 200">
                <path d="M150 20 L50 180 L250 180 Z" fill="none" stroke="white" stroke-width="3"/>
                <line x1="100" y1="100" x2="200" y2="100" stroke="white" stroke-width="3"/>
                <text x="145" y="15" fill="white">A</text><text x="35" y="195" fill="white">B</text>
                <text x="255" y="195" fill="white">C</text><text x="75" y="105" fill="white">M</text>
                <text x="210" y="105" fill="white">N</text><text x="138" y="95" fill="yellow">3cm</text>
            </svg>`;
}
if(type === "midsegments") {
            return `<svg width="300" height="200" viewBox="0 0 300 200">
                <path d="M150 20 L50 180 L250 180 Z" fill="none" stroke="white" stroke-width="3"/>
                <line x1="100" y1="100" x2="200" y2="100" stroke="white" stroke-width="3"/>
                <text x="145" y="15" fill="white">A</text><text x="35" y="195" fill="white">B</text>
                <text x="255" y="195" fill="white">C</text><text x="75" y="105" fill="white">M</text>
                <text x="210" y="105" fill="white">N</text><text x="138" y="95" fill="yellow">4dm</text>
            </svg>`;
        }
        return "";
    }
    function renderQuestion() {
        const item = DB[current];
        const opts = document.getElementById('options-area');
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('explain-box').style.display = 'none';
        
        let html = `<p>${item.q}</p>`;
        if(item.img) html += drawSVG(item.img);
        if(item.hasTable) html += `<table><tr><td>X·∫øp lo·∫°i</td><td>T·ªët</td><td>Kh√°</td><td>ƒê·∫°t</td><td>Ch∆∞a ƒë·∫°t</td></tr><tr><td>T·ªâ l·ªá</td><td>5%</td><td>45%</td><td>44%</td><td>6%</td></tr></table>`;
        
        document.getElementById('q-text').innerHTML = html;
        opts.innerHTML = "";

        if(item.isTF) {
            let table = `<table><tr><th>N·ªôi dung</th><th>ƒê√∫ng</th><th>Sai</th></tr>`;
            item.sub.forEach((text, i) => {
                table += `<tr data-row="${i}"><td>${text}</td>
                <td style="cursor:pointer" onclick="checkTF(${i}, true, this)">ƒê</td>
                <td style="cursor:pointer" onclick="checkTF(${i}, false, this)">S</td></tr>`;
            });
            opts.innerHTML = table + "</table>";
        } else {
            const labels = ['A','B','C','D'];
            item.a.forEach((text, i) => {
                const d = document.createElement('div');
                d.className = 'option';
                d.innerHTML = `<strong>${labels[i]}.</strong> &nbsp; ${text}`;
                d.onclick = () => checkMC(i, d);
                opts.appendChild(d);
            });
        }
        MathJax.typesetPromise();
    }

    function checkMC(idx, el) {
        const item = DB[current];
        const all = document.querySelectorAll('.option');
        all.forEach(o => o.onclick = null);
        if(idx === item.c) {
            el.classList.add('correct'); playSnd('snd-correct'); score += (10 / DB.length);
        } else {
            el.classList.add('wrong'); all[item.c].classList.add('correct'); playSnd('snd-wrong');
            const box = document.getElementById('explain-box');
            box.innerHTML = `<strong>Gi·∫£i th√≠ch:</strong> ${item.e}`;
            box.style.display = 'block';
        }
        updateHeader();
        document.getElementById('btn-next').style.display = 'block';
        MathJax.typesetPromise();
    }

    function checkTF(rowIdx, choice, el) {
        const item = DB[current];
        const row = document.querySelector(`tr[data-row="${rowIdx}"]`);
        if(row.getAttribute('data-ans')) return;
        row.setAttribute('data-ans', 'true');

        const correct = (choice === item.ans[rowIdx]);
        el.style.backgroundColor = correct ? "#2e7d32" : "#c62828";
        if(correct) { playSnd('snd-correct'); score += (10 / (DB.length * item.sub.length)); }
        else { playSnd('snd-wrong'); }
        
        updateHeader();

        if(document.querySelectorAll('tr[data-ans="true"]').length === item.sub.length) {
            document.getElementById('explain-box').innerHTML = `<strong>Gi·∫£i th√≠ch:</strong> ${item.e}`;
            document.getElementById('explain-box').style.display = 'block';
            document.getElementById('btn-next').style.display = 'block';
            MathJax.typesetPromise();
        }
    }

    function goNext() {
        current++;
        if(current < DB.length) renderQuestion();
        else {
            document.getElementById('quiz-screen').classList.remove('active');
            document.getElementById('result-screen').classList.add('active');
            document.getElementById('final-score').innerText = `ƒêi·ªÉm: ${Math.round(score * 10) / 10}`;
        }
    }

    function submitScore() {
        const status = document.getElementById('status-text');
        if(SCRIPT_URL.includes("D√ÅN_LINK")) return alert("Ch∆∞a c√≥ link g·ª≠i ƒëi·ªÉm!");
        
        status.innerText = "ƒêang g·ª≠i...";
        const payload = {
    name: sName,
    class: sClass, 
    score: (Math.round(score * 10) / 10),
    attempts: retry, 
    quizId: "Toan8_CuoiKy1" // <--- T√™n n√†y s·∫Ω t·ª± t·∫°o Sheet "Toan8_CuoiKy1"
};

        fetch(SCRIPT_URL, {
            method: 'POST', mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(() => {
            status.innerText = "";
            document.getElementById('thanks-container').innerText = "Em l√†m t·ªët l·∫Øm. Th·∫ßy/C√¥ ƒë√£ nh·∫≠n ƒë∆∞·ª£c b√†i c·ªßa em";
            document.getElementById('submit-btn').style.display = 'none';
        }).catch(() => status.innerText = "L·ªói khi n·ªôp b√†i!");
    }

    function restartAll() {
        current = 0; score = 0; retry++;
        updateHeader();
        document.getElementById('result-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');
        document.getElementById('thanks-container').innerText = "";
        renderQuestion();
    }
</script>
</body>
</html>